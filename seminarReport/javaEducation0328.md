# Java研修 第9回#



----------

プログラム言語Java

----------

---
ex22_05

```
int M = (Integer.MAX_VALUE/3)*2;
Random r = new Random();
Math.abs(r.nextInt()) % M; //確率が均等にならない
```

abs()は必ず正の値を返すとは限らない。
```
int abs(int x){
    if(x < 0)
        return -x;
    return -x;
}
```
Integer.MAX_VALUE=01....1
Integer.MAX_VALUEに対応する負の値は10....01
Integer.MIN_VALUEは10....0
２の補数表現をしてもInteger.MIN_VALUEは10...0に戻る（負の値になる。）

---

ex22_09

最長一致 ^(.*),(.*),(.*),(.*)$
最短一致 ^(.*?),(.*?),(.*?),(.*?)$
^([^,]*+),([^,]*+),([^,]*+),([^,]*+)$
^([^,]*?),([^,]*?),([^,]*?),([^,]*?)$



---
P585	setProPertyメソッドの戻り値は「以前の値を返します」について、普通setの戻り値はtrueかfalseとなりますが、ここの戻り値を「以前の設定値」にするには何か意味あるでしょうか？

**二行書くのがイヤなので。**

---

P587	nanoTimeについて「精度はナノ秒ですが、その精度は保証されません」とはどういう意味でしょうか


P587	なぜnanotimeの精度は保証できないですか？タイマーはシステムによって精度が違うですか？

P587	nanoTime()の精度はナノ秒ですが、その精度は保障されていないとあります。精度のあるナノ秒単位の時間測定を行う方法はないのでしょうか。



**ナノ秒単位で値を取得するが、1ナノ秒精度か10ナノ秒精度かは保証できないということ。**

---

P587	Java仮想マシンが動作している「ほとんどの」システムは、複数のプログラムを実行できるとありますが、複数のプログラムを実行できないシステムもあるということでしょうか。

**JavaRing、JavaTipなどの環境。**

---

P588	標準入出力＝コンソール入出力、という認識は間違っていますか？子プロセスの標準入出力はデフォルトではコンソールに結びついていないようですが、どことも結びついていないのでしょうか？

**標準入出力は起動する側が決める。Javaの場合はJVMが指定する。子プロセスは親プロセスにパイプされる。パイプは有限で、満杯になると子プロセスも止まってしまうので注意**

---

P591	「しかし、javaではないプログラムを実行するには、環境を問い合わせて、その後環境を修正する必要が残ります。」ここの話を理解できませんでした。非javaプログラムをsetProPertyで環境を修正すればJava仮想マシンで動くことができますっという意味ですか？

**Java以外のプログラムでは起動後に環境変数を取り込むプログラムが多くある。通常、Javaのプログラムは起動時に値を引数で取り込むのが一般的なので、他のプログラム用に環境変数を設定する必要がある。**

---
P592	プロセスを開始させることを選択するのは、非常に慎重になってください。”とありますがどのような点を考慮すればいいでしょうか？

**修正はできる。プロセスを起動するということは、Javaで書いているからと言ってどこでも動くわけではないということになる。（移植性という観点で）**

---

P593	シャットダウンフックを業務で実際に使うような例等はどのようなものが考えられるのでしょうか。データベース処理などは、データベースのほうに処理を任せてしまいそうなものですが・・・。

**シグナルCtrl+Cを送信したりする人がいる場合を踏まえて、実装するときなど。**

---

P595	例外を受け取り最後に処理するプログラムはシェルかGUIのコードですよね？
受け取るメソッドを明確に決める定石はありますか？

**製品の場合、スレッドが何らかの理由でキャッチされない例外で死んだ場合、どこかに必ずアナウンスする必要がある。1.5以降はシステム全体にスレッドが死んだ場合を検出・通知を設定ができる。**

---

P601	呼び出し連鎖内にあるどれかの呼び出しに対するコードが要求された許可を持たなければAccessControlExcePtionがスローされます。ただし、指定された許可を与えられた呼び出し元が特権とされていて、その呼び出し元から（直接的あるいは間接的に）呼び出されたものは結果としてその許可を持っています。＝
というのは呼び出されたスレッドのメソッドのどれかが特権を持っていれば許可されてるってことですよね？


**通常はセキュリティ機能はONになっていない。ただしSecurity Managerが起動した瞬間に多くの操作に対して権限必要になる。特権を持っていないプログラムが実行に権限が必要なAPIを呼んだとき、セキュリティチェックが特権を持っていないプログラムまで遡って権限を確認し、セキュリティ違反になる。そのため、実行に権限が必要なAPIまででセキュリティチェックの遡りを停止する実装が必要になる。**

---

P602	PrivilegedActionはなぜTオブジェクトを返すのですか？例では返すものが無いとしてnullが返されるみたいですが。

---

P606	リソースが文字列型が普通なのはなぜでしょうか。

**もしかしたら未来ではアイコンとかもあるかも**

---

P607	左利きでキリバスに住む…の検索の例がよくわかりません。

**左利きの人用にローカライズしてみた例**

---

P608	ListResourceBundleを用いずに、値が文字列しかとれないProPertyResouceBundleクラスを利用するメリットはなんですか。


**テキストファイル用意するだけで便利だったり。**

---

P610	ResourceBundleのサブクラスとはどういう場合に作成しますか？
ListResourceBundleやプロパティでできないことがサブクラスではできるのでしょうか？

**実装次第。**

---

P610	練習問題24.1で、ProPertiesファイルを読み込ませる事ができません。GlobalRes_ja_JP.ProPertiesファイルを作成し、ロケールをLocale.JAPANにセットしましたが、どこに問題があるか見て頂けないでしょうか。

**できたよ!**

---

P610	通貨単位が標準ライブラリに含まれることに違和感を感じます。国際情勢の変化により通貨単位が変わった場合、対応できないように思えるのですが。

**Javaの最新版で対応していることを願う。。。**

---


P611	$記号はカナダのロケールでのカナダ$の為に予約されていると、あります。これの意図するところは、実際に使われる記号、というよりは、これで取得できる値にユニーク性を持たせたいからだと思われますが、
getSymbolで取得した値をもとに、通貨計算のロジックに組み込んだりが可能なくらいはユニークという風に考えていいのでしょうか。

**getSymbole()はそのlocaleでその通貨がどのような記号で表現されているかがわかるだけ。**

----------


P612	現在のタイムゾーンに調整された形式とは、時差考慮のみですか。
“Sun”ではなく”日”と表示させたりすることは、後述のDateFormatを用いなければ困難ですか。

**実装頑張ろう。。。**


---

P613	このサンプルコードでは Calender.clone();を使ってコピーを使っていますが、
そもそもなぜCalender型のオブジェクトは変更可能な値を持っているのでしょうか。
cloneをし忘れるバグなどが、多く考えられると思うのですが。

**不変にしたいのだったら毎回newするしかない。そもそもDateとCalenderは設計がくｓ。。。**


---

P631	以降に記載されている標準パッケージ以外に、デファクトスタンダードとなっているパッケージはありますか。

**最新情報を追っていきましょう。JavaもJava8で標準パッケージが増えています。**

---

P634	「サンドボックス」とはどのような単位なのでしょうか。

**http://ja.wikipedia.org/wiki/%E3%82%B5%E3%83%B3%E3%83%89%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9_(%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3)**

**root権限がないlinuxユーザがいるような環境状況**

---

P635	JavaBeansの定義は「開発ツール上でビジュアル操作によって扱える、再利用可能なソフトウェア・コンポーネントである」とありましたので、この節で書かれている「JavaBeansシステム」とは、特定の既存のシステムではなく、既存のものに限らずJavaBeansのモデルに沿って作成されたシステムのことを指していて、誰でも作れるものですか？

---

P643	「強制的に生きている必要がないと判断したら、その参照を強制的に落とすことが出来ます」と書いてありますが、この「判断」は自動的に行われるのですか。また、「強制的に落とす」とは参照元の情報を取得して無理やり参照をやめさせるのでしょうか

**基本的にはネットワーク環境に依存するので、サーバの判断が必ず正しいとは限らない。**

---

P659	付録ではジェネリック型を例にAPIの変更に関する問題を言及していますが、その他に注意すべき点はありますか。

**targetが新しくなるとクラスファイルも変更されている。古い環境では動かないこともある。大きな言語仕様の変更があった1.5、1.8をまたぐ移行のときは注意する。**


---



P3	確認ですが、メソッドのシグニチャにメソッドの戻り値型が含まれないのは、オーバーロードの条件に戻り値型が含まれていないからでよろしいでしょうか？

**はい**

---

P6	「これは、どのクラスのオブジェクトを返すかという選択の柔軟性を大きく広げます。」ここの文書を理解できませんでした。

**別のサブクラスでも構わないということ。**

---

P6	インターフェースがスタティックメソッドを呼ぶことができるようになることで、このあたりの今後の実装方法も、変わってくるのでしょうか。

**utilをインターフェースに書くことができるようになるので、デザインに大きく影響を与えるかもしれない。**

---

P6	ファクトリクラスの命名慣習として○○sとありますが、これの s はどのような意図を持たせた命名なのでしょうか。Collections や Files 等に見られますが。

**複数形**

---


次回はP7からの輪読。
デザインパターンの話題は頻出するので、そちらの予習もしておくこと。
