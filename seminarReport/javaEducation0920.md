# Java研修 第3回#



----------

プログラム言語Java

----------

質問


----------


----------
なぜ`super.clone()`をしなければいけないのか。  

[http://funini.com/kei/java/clone.shtml](http://funini.com/kei/java/clone.shtml)


----------
次回（9月）は、練習問題３．９から。
練習問題3.11「気づかれること無くメトリクスに関して不正を行える」＝「もともとの設計者に気づかれること無く」という意味でしょうか？
「SortDoubleのセキュリティホール」を少なくともひとつ見つけなさい。
「セキュリティホール」になりうる、状況を具体的に教えてください、またどういった設計で防御すればよいのでしょうか？
「この場合ソートアルゴリズムの作成者はmainを書かないと想定してください。」＝つまり、「privateメンバーに直接はアクセスできない」という意味でしょうか


----------




----------


練習問題3.12　「どのようなオブジェクト型でもソートできる」＝
sortメソッドの引数を「Object配列」にすればよいのでしょうか？
「オブジェクトの比較をするのに＜は使用できないとしてオブジェクトの順序を表す方法をどのように提供しますか」Comparableインタフェースを実装してcompareToを使用しますか？


----------


Javaはインターフェースの多重継承を許可していますが、クラスは単一継承のみ許可しています。そのため、複数のクラスの実装を継承する事ができません。Rubyでは、Mix-inという仕組みによってそれを回避していますが、Javaでもそのような方法はあるのでしょうか？

**コンポジションをしてラップメソッドを定義する。**  
**Go言語だとコンポジションしたいクラスのインスタンスを持つだけでラップメソッドを宣言しなくてもコンポジションインスタンスのメソッドが呼ばれる。**


    Class Z impliments X, Y{
        X objX = new Ximpl();
        Y objY = new Yimpl();
        fooMethod(){
           Ximpl.fooMethod();
        }
    } 


----------


「インターフェースの定数フィールドは暗黙にpublicかつstaticかつfinal」とは、「変更不可能な定数フィールドを持たせることができる」という意味ですよね？

**その通りです。**

----------




----------

インターフェース定数は、修飾子に何もつけないとデフォルトでstaticになるとありますが、非staticのインターフェース定数はできない、ということでよいでしょうか。


**その通りです。**

----------



----------
定数の継承についての問題です。スーパーインタフェースとサブインタフェースにて同じ名前の定数があり、スーパーインタフェースと
サブインタフェース両方を実現するクラスがその名前の定数（super.変数を明示しない場合）利用するときにサブインタフェースのほうを利用するでしょうか？

**その通りです。**

----------

Attributedにiterableを実装するのは間違い、としていますが、このインターフェースではiteratorを利用して実装することが前提のインタフェースである印象を受けます。必ずこのインターフェースでは属性を利用するためのitratorを返すという意味があると思われるのに、iterableを実装することがなぜ間違なのでしょうか。これも、clonableと同様、マーカインターフェースとしての役割があるからなのでしょうか。

**iterableであることはインターフェースとして指定しているが、`Attr`の何を返却するのかはImplする側がきめることなので、インターフェース内で実装するのは間違いである。**

----------


練習問題4.3
LinkedListクラスはインタフェースであるべきですか?
LinkedListメソッドをオブジェクトごとにカスタマイズする場合にはインターフェースであるべきです。
テキストp500のJavaのコレクション型階層の下位階層の一つであるListの下のLinkedListインタフェースはどのような設計思想、
恩恵を利用して使用するものですか？


----------




----------


練習問題4.4の「インタフェースのみを使用して、コレクションクラス階層を設計しなさい」という問題の意図に対する解答は下記の方法で正しいでしょうか？

    import java.util.*; 
    
    public interface Collection<E> extends Iterable<E>{
    boolean add(E e);
    boolean addAll(Collection<? extends E> c);
    void clear(); 
    boolean contains(Object o); 
    boolean containsAll(Collection<?> c);
    boolean equals (Object o);
    int hashCode();
    boolean isEmpty(); 
    Iterable<P> iterator(); ←また、これが構文エラーとなる　：なぜでしょうか？
    boolean remove(Object o); 
    boolean removeAll(Collection<?> c);
    boolean retainAll(Collection<?> c);
    int size();
    Object[] toArray();
    <T> T[] toArray(T[] a); 
    }


**問題が悪いので余談**  
`Set`インターフェースはある種のマーカーインターフェース。  
`Collection`に機能の追加はしておらず、契約の追加しかされていない  
＃要素に重複を許さないという追加契約


----------



----------



練習問題4.5 次に型がインタフェース、抽象クラス、具象クラスのどれで表現するべきかを考えなさい
練習問題4.6↑の各問題に対する仮定をどのように変更するとあなたの答えが変更されますか？
(a)Ｎ分木のノード：TreeNode　　　　　
A) 抽象クラス
実装をTreeNode用途ごとに選ぶ状況ではインタフェース
フィールドをTreeNodeで流用したいから抽象クラス

(b)特定の順番　深さ優先
　　　　　　　　幅優先　TreeWalker
B)インターフェース
実装をTreeWalker用途ごとに選ぶ状況ではインタフェース
流用するなら抽象クラス

(c)グラフィックシステムにより描画可能なオブジェクトのためのDrawable

C)インターフェース
描画可能なオブジェクトごとに実装するのではなく
流用するのであれば抽象クラス

(d)グラフィックデスクトップから実行できるプログラムのためのApplication

D)具象クラス

(d)のapplicationを流用するのならインタフェースか抽象クラス

で解答は正しいでしょうか？


----------


----------


クラスをネストすることによるメリットがよく理解できませんでした。
「型の構成やスコープを論理的に関連したグループにまとめる」ことが
ネストクラスの利点とありますが、
これはを実現するにはpackageなどの仕組みでは不十分なのでしょうか？



----------



----------


staticのネストしたクラスと内部クラスの違いがよく分かりません。
Permissionsクラスは普通の内部クラスとして宣言してはいけないのでしょうか？
static修飾子がついたメンバはオブジェクト間で共有されるものという認識なのですが、Permissionsクラス内のメンバはインスタンスが持つ値ですし内部クラスでいいと思うのですが。。。


----------


----------


内部クラスをインポートして使用できるとありますが、
BackAccountクラスの例でいうと、Permissionクラスのオブジェクトには
BackAccountクラスのメンバ変数（number、balance）はないという認識でよいですか？


----------


----------


this.new (内部クラス名)という書き方を初めて知りました。ところで、この書き方で、この内部クラスをnewする事はできたのですが、super.new (スーパークラスの内部クラス名)と書くと、エラーになりました。superを使ってこの書き方はできないのでしょうか？



----------


内部クラス宣言のstaticメンバーの制約はなぜでしょうか。
Final staticフィールド以外のstaticフィールドを持てても問題ないかと思います。


----------


Outerのサブクラスでは無いのにOuterのオブジェクトのコンストラクタを呼ばなければいけないのならば、最初からOuterもしくはOuterを拡張したクラスの内部クラスとして宣言したほうがいいと思うのですが、内部クラスだけを拡張したクラスを作るということはあるのでしょうか？テキストにも極力さけるべきとありますが、これは間違った設計なのでやらないほうが良いという例で説明してますか？


----------


他の関係ない内部クラスを拡張するような設計は極力さけるべきとの記載ですが、逆にこれが有効となるようなケースがあるのでしょうか。

----------


サンプルコードでHelperクラスがUnknownを拡張しない場合に、incrementメソッドをthis.x++とすると、エラーでコンパイルできません。普通のx++もしくはHost.this.x++だとHostクラスのxをインクリメントできます。内部クラスの中ではエンクロージングクラス内で宣言されているすべての名前がスコープ内にあるはずですが、this.xではどうしてエラーになるのでしょうか？


----------


ローカル内部クラスの使いシーンは良くわかりません。サブスレッドの新規処理に使われますか？


----------


----------



無名内部クラスのメリットがよくわかりません。簡潔なクラスの見た目を良くする、ということだけですか。

----------




----------

「HighSpeedPrinter内で定義された…その新たなサブクラスからクラスPrinterは何も影響を受けません」。その意味は、
HighSpeedPrinterのSerialPortはPrinterのSerialPortを継承できていないことでしょうか？


----------


「インタフェース内にネストしているクラスやインタフェースはpublicでかつstaticです」とありますが、staticにしたくない場合は、ネストせずにインタフェースの外部で定義するしかないのでしょうか。


----------


リフレクションを使用した場合、ローカル内部クラスはNInnerという名前で見えるということでよろしいでしょうか。

----------


enumのアクセス修飾子はpublicか付けないかのどちらか、と書いてありますが、そのクラス内でしか使用しない場合はprivateでもいいのではないのでしょうか？
"
"enumに明示的にfinalと宣言できない理由はこの後すぐに説明する、と書いてありますが、テキストのどの部分がその説明にあたるのでしょうか？
"
"java.lang.Enumクラスのように循環したクラスを自分で定義するような場面はありますか？
Enumクラスの利便性はわかるのですが、循環クラスにしたことで享受するメリットがよくわかりませんでした。"
"enumを使用すべきか否か。という点において、複雑でなければ（複数の）定数はenumで表現するほうが良いと感じまして、それは良いのですが、アプリケーションのエラー内容とエラーコードなどを格納するような定数クラスもenum化することは特に問題ないでしょうか。
（enumの要素一つに、READ_ERROR（”0001”,”読み込みエラーです”) ;と定義する等。）"
enum定数固有の振る舞いを持つenum定数を宣言している場合は、enumを使用すべきか否か考慮が必要とありますが、その判断は何を目安にすれば良いでしょうか。
"enumは、enumerated typeから来ているとのことですが、こちらはどう読むのが正しいのでしょうか。イーナム、またはエナム、という言い方を聞いたことがあります。
"
"トップレベルのクラスはenum型であっても必ずファイルを分ける必要があるのでしょうか。分けずに１つのファイルで書いたときどのような
デメリットがあるのでしょうか。"
"「enum 定数をシリアライズする場合には、name フィールドだけがシ
リアライズされます。他のフィールドは一切シリアライズされません」とありますが、この変更によってどんなことが変化したのでしょうか。"
"public static <E extends Enum<E>> EnumSet<E> of(E first, E... rest)
可変長引数メソッドを定義しているのに、5こまでの固定長引数メソッドも用意されています。
可変長引数メソッドを定義してあるときでも、ある程度の固定長引数メソッドは用意するべきなのでしょうか？
＃特定の引数の数のときに最適化ができるならば、固定数のメソッドを用意する。という認識でよろしいでしょうか。"
enumをインターフェースを実装する形式で定義することもできるとありますが、定数特有の振る舞いを抽象メソッドとして定義する方法とインターフェースで定義する方法では何が違うのでしょうか？
Eclipseで実装後、外部ツールのCheckStyleで静的解析を行うと「タブ」に対して警告が出てきます。Javaコードではタブをりようするのは本来あまり望ましくないのでしょうか。
"7.1.4 識別子　の４行から、「今日世界で書かれているほとんどの文字を使用できます」。
Π（パイ）を使うのか考えられるが、実際に日本語などの識別子を使うシーンはありますでしょうか？"
"整数型でさまざまに使われているのは、int型であると感じていますが、配列を使わない時の数値や、shortで収まると思われる数をカウントするときなどは、
shortは使ったりはしないのでしょうか。"
"Intサイズ以上の配列を利用したい場合どうすればよいのでしょうか
"
配列が示す配列要素の変更許可の管理をJavaでサポートしない理由はありますか。C++ではconst int * const intArrayと配列要素の変更も制限できるので、技術的にはJavaでも可能だとおもうのですが。
"無名配列は変数名をついてないので、newして一回使ったらもう使えないですか？
"
"単なるintですむ箇所では、オブジェクトは多くのオーバーヘッドをもたらすかもしれません、とありますが、どのようなオーバーヘッドでしょうか。
"
Characterクラスは、new Character(数値）のコンストラクタを持たないのですね。C言語では、unsigned charが0～255の範囲という事を利用して、画像のRGB値を保存するのにunsigned char型をよく利用したのですが、javaではchar型は文字を表現するという目的でしか使わない、という事でよろしいでしょうか。
"new Integer('あ'); という書き方はエラーにならず、'あ'=12354の値が生成されるのに、new Character(12354)という書き方はエラーになります。
逆に、Character c = 12354; という書き方はエラーにならないのに、Integer x = 'あ'; という書き方はエラーになります。
なぜでしょうか？"
"Integer i = new Integer(1);
Integer i = Integer.valueOf(1);
だと、後者のほうがが良いという風に説明から読み取れたがそれで正しいでしょうか。
どちらも作られるオブジェクトは1つのように感じますが、
これは、2回以上呼ばれた時に、後者だと同じオブジェクトが呼ばれるからリソースの節約や速度向上につながる、ということでしょうか。"
"equalsはオブジェクトを比較する場合、フィールドの値、メソッド、内部クラスなど、修飾子やオブジェクト全ての内容の同一性をチェックしますか？
"
”Boolean.parseBoolean”が”ｔRue”などの大小混合文字を”true”と解釈するメリットが分かりません。前後にスペースが入るだけでも”false”と解釈されてしまいました。大小混合に利便性を感じないのですがメリットがあるのであれば知りたいです。
"NaNはどういったときに使いますか？∞
"
"タイトル文字というのがどのような文字なのかピンときていないのですが、日本語と英語にもタイトル文字はありますか？
"
"ボクシング変換のメリットについてです。
「データ自体のバリューを知りたい場合、ボクシング変更をする必要はなく、
データを動作したい（共通メソッドを利用など）場合、ボクシング変更をしたほうがやりやすい」
とはメリットですか？"
"「ボクシング変換は十分なメモリがない場合、失敗する可能性があることを～」とありますが、Integerオブジェクトなどの作成にそこまでメモリが必要なのでしょうか？
＃ボクシング（アンボクシング）だからメモリを消費するということでしょうか。"
ある型のある値の範囲に対するボクシング変換は、常に同じオブジェクトになるように要求されるとあります。その範囲内のキャッシュされたラッパーオブジェクト同士の比較には「==」が使用できますが、範囲外のラッパーオブジェクトは別のオブジェクトとして生成されるため、「==」では正しく比較が行えません。このことから、ラッパーオブジェクトの比較は常に「equals()」を用いるべきでしょうか？
"なぜJavaはオーバーフローを避けるつくりにしたのでしょうか。
これによって、intなどの計算がオーバーフローしたかどうかを確認しづらくなっているような気がします。"
"float型、double型の計算結果がNaNになったとき、例外をスローしないのはなぜですか。
"
"浮動小数点算術の厳密性が有効に働く例を教えてください。
"
"floatの等価演算についてです。
よくあるのは、5.0/2.0の結果は2.4xxxxxとなり、２回の計算結果を比較するとfalseが返してくれる。
対応としていつも小数点以後n桁まで四捨五入して再比較しますが、それより良い方法はないですか。"
「括弧（）は、Java言語では必要とされていません。」とは、CやC++では括弧がないとコンパイルエラーになるような式でもJavaでは括弧が必要ないという意味でしょうか？だとすると、どのような具体例がありますか？
「すべてのメソッドがabstractであれば、その１つが任意に選択されます。」というのの意味がとれませんでした。どのメソッドが選択されるかわからない、という意味でしょうか？すると、メソッド呼び出しに曖昧さが残ると思うのですが。
"Switch文内のdefaultケースには例外処理を入れるのは標準的なのでしょうか
"
"業務でもSwitch文でFALLTHROUGH(わざとbreakしない)を利用することはありますか？
明示的にコメントで意図的に行っていることを書けば利用しても良いのでしょうか？"
do-whileはループ本体を少なくとも一度は実行したいときに使えるということですが、ループ本体を一度でも実行したいというのはどのようなケースでしょうか？未だに実装でここはdo-whileで書こうと思ったことがありません。
"do-while文は実際に利用したことや見たことがありません。また、今回の練習問題でもdo-while文を適用させたいようなケースはありませんでした。
do-while文のように「必ず1回は何かをやりたい場合」というのが実際にあるのでしょうか。また、 while文でも少し処理を工夫すればdo-whileと同じ動きをするプログラムが、できると思われますが、do-while文にする ような判断はどのようにすればよいのでしょうか。"
"ラベル付きのbreak文、continue文は一般的に使用されるものなのでしょうか？
C/C++では、コード内の制御の流れが不明瞭になってしまうため、goto文の使用を控えていました。Javaではgoto文が使えない代わりに、ラベル付きのbreak文、continue文が使えますが、これらの文も多用しすぎると制御の流れが不明瞭になってしまう可能性があると思います。"
"ジェネリック型との
"
"「基本データ型の値をボクシングにより参照型へ変換した場合には、同じ値に対して同じインスタンスの参照が返される仕様が理想ですが、
現実的ではありません」とありますが、どういう理由でその仕様が困難なのでしょうか。"
"事前に用意されたインスタンスを返すとありますが、これらのインスタンスはどのタイミングで生成されるのですか？
"
自らでIterableインタフェースを実装する場合と、機能の近いコレクションを拡張する場合のふたつが設計で考えられたとき、どちらを選ぶのが効率的でしょうか。＃レビューでの説明負担や、第三者の可読性も加味した上で
